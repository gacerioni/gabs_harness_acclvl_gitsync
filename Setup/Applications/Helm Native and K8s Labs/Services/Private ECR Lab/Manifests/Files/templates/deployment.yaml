{{- if .Values.env.config}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{.Values.name}}
data:
{{.Values.env.config | toYaml | indent 2}}
---
{{- end}}

{{- if .Values.env.secrets}}
apiVersion: v1
kind: Secret
metadata:
  name: {{.Values.name}}
stringData:
{{.Values.env.secrets | toYaml | indent 2}}
---
{{- end}}

{{- if .Values.dockercfg}}
apiVersion: v1
kind: Secret
metadata:
  name: {{.Values.name}}-dockercfg
  annotations:
    harness.io/skip-versioning: true
data:
  .dockerconfigjson: ewoJImF1dGhzIjogewoJCSI5MTU2MzI3OTE2OTguZGtyLmVjci5zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSI6IHsKCQkJImF1dGgiOiAiUVZkVE9tVjVTbmRaV0d4ellqSkdhMGxxYjJsV1ZXaEpZMjFrYzFOWGVHcFJNREZNWW1wQ1lXTnRjelJsVmtwMVdXNW9VMVl5T1RKUFZFSjRVakJhYlUwelFrOWFibWN3VGtaR2RHTnJkelZsUjFVMVRWVmtkMUV6UVRGbGEwNUhUWGx6TVZOdFNYWmlNSGgzVW10NGNGRlZSakJoVm1zMFdWVkdVRm94WnpSV01ERkRVMnBhVFU5SVVqSmxSbG8yVFZVeFZWWnBjekpoUkVFeFpVaGFkbFpzVVROWmFrWldUbTVDVDFwdVVrOVdia2sxWTBVeFVHTnFUalJWVlRFMVpWVjBlV0p1U25kaGEwVTBaRVJzVGxkWFZsbFNNRXBJWVZob1YwNUdVa3BNTTJSVlkxaEdiRmx1VmtKTldFWjFVVlZhZUdOcVkzcGxSV1JRV1Zab1YxWlhkRTFPYkZKMlZESm5NbEpGTlZaaGFtTTFWVEZTUmxadVVsRmhha1pVVjFkc1UwNHlVblJoTVd4R1ltMXNlRlJyY0ZwVVYyOHlWRVJPV2xGV1RsQmtlbVF6WkVkb2ExUlZPVEZoTWtWNVZqRlpNazVGTVVkalZ6VjNZMGRuTUZSRVozZGhWVFZGVDFkemQxRlhXbEpNTUhCMFUwUm9jMXBIWTNKT01HUjVUVE5LU2s5R2FGRk5WM2hPVFRCU1RsSkZkRFZoZWtFMFpVaG5NbFJwT1hwaVYyTjVUbnBDYVU0eWRIQk9WVkp0V1cxTk1sWkRPVlZhUnpWRVRWZDNNbEpyWjNoaE1IaDVXVmRrTTAxdVNtRlBWV1J3VDFkNE5rNXJNVkJPUjJ4V1lrZEtNRTV0Vm5saFIwcFlZMFZXZDJONldrbGhSVTQxWld4S2EySkdUbXBSTTFFeVVsVktVR0ZGVWpaTlJVWjNWa1JSZUZOSE1VTmpSWEJGVFZac1ZsZHNVbHBVTVdoWVRucEtUMDVzVVRCa2EwNVpUSHBaTVdKNWRFSk9NMDB6WWxWU2RWVnBkRkprVldjMFQxZHNNVTB4WjNaU1dHTXlWbGRXVVdFeFVtcGhhWFJhWkRCa2NsRjZhSFZUTVZaMVYwWmtUR1JJYUVSTE1FcENZMGhOTTJKSFdrZGpibHBoWTBjeE1HRXdaRzFOVlZaMFZsUmFSRTlYV2pSWmVrSnpVVlJPZUZwSE5YWk5NVnBoVjFoS1JXTkhkR2hqTWtaRllrWkdSMkV6VWpaUldFVTFUMVpGZDFOV1drTmxWR3hRWW01T1NsUjZVWFpVYWs1MllqQk9jRTlYVlRSTU1VSmFXbXhuTTA0d2RETk9hbEkwWWtoQ01HTlhWa2RVTWpWRFpWWk9jRkl6V1hsUmJrcHJWR3h3V0UxWVZrZGphelZ3VGtaR01sRnJWbEJYYkd4U1N6SktVazlIVm5SUmJGSndWakpLYkZSdE1ERmtia0V4VW10S1dHTllhR2xPYmxwdFlYcE9WVlV3VWpCT2JGWjRWMGRyZGxwdWJGQldhbEpGV2tab1Ywd3haekZrVmtrelRtcGpNMlJFVGt4Vk1IZDVUbXBHVjJGcE9WVmtRemgyVjIweFdVc3lOWGxTUjNBMVkxZGthbUZxUm5aWmF6bFFUMWRrVFZwVlJucGlSM2hKV1Zad1FsSXlUak5oVlhSUVZraFdOVTFIVGxKWFZteFJWRlpLYTFNeFpGbE1NRTVVV1hrNWNWSkZaREZhUXpsUlZqRkNTRTVGY0ZKaFIwcGhVakJrY2xWWWFGWmpWbU55VVc1b1lWa3ljSGhrU0ZwNldUSlNTVlpYWkhKbGJtOTNUbXRTZDFFeFVuZGtSRUpoVFhwU2JHUklXbEJWTTBKRlZVYzVVbUZzWkhSWFJ6QjZUa2hhVWswelNsZFViVXBYWkZkV2FsUlZUbEphYmxaSlkxUktVRlJYYzNoVWJXUlBVVzVLYm1WcVdqVmtibXd6V1ROYWJGVXlVbkJpU0VKYVZrVkpNR0V3Um14TlJtZzBWRE5HY0dSSFRsQmFWbGw1WWtWb1FrdDVkREpSYlRVMVRrVmtSR05VUWpCT00wNXNVek53Vmswd1RsVk9RemxFWW1rNVJXSnNiRmxrU0VaWVZsaHJNbE5JUm5wTlZFNU5aREZ3ZDBzelJuSmtSbEpWVGxSc1JGRXhSbmhQVnpsNlN6Tm5lbUZGVmpWaFdGRjJZVlpvY2xaWGNGWmtSWEIxWWpKak1sbFZkRFJOZWs1RVN6QjRVRm93VWtSVmJFNUZWRmM1V21KSGNGaFZSMFZ5VVZaS1lVOUlSbk5hUm1oc1lWUlNlbVJ0U214UFJFWnNVMFJrZEZReVduSlZWV2hXWVZoa1FsTnJaRVpWTVZKaFYwWmpNVmRyT1cxbGFscEZVMGM0TlZsdGNFUmtSbFpZWTFWb1RrMXNhelZoV0ZwdFdsaEdXV0ZzUmtKUFYyUjJUa1Z3V21JeVdqWmFSMUpEV2pKNGVHUjZNRGxKYVhkcFdrZEdNRmxYZEd4bFUwazJTV3RHVWxOVlNrSlRSM0JSWkVjNU1GbFhiRWRSYkVZeFRUTm9UbVJYZHpCaU0yaFBUVVJPVEdWc1drNU9SR2hPV210V1MySllTVEJpU0d0M1pXNU9kRlJJVmxKU1ZHeFBUVEZDTWxsWGJIQmxiV3N4WVZoU2ExUXhWakJpVXpsM1dqQkdRbEZWUm0xaGEwazBVVzFrY21OWGFISmhWV00xWkhwQ1ExRnVaR2hhTWtvMlVXNVNRbG93VmtKVVZXUnVVakJPVkdOVlpGUlRWMGw2VWtaR1JsTkZSbFZSVjFaRFdqSjRibUZIZEc1UmJIQlNWRlZXUWxWNlVqTlNWa1pTVkZWUmVWUkZkSGhVUkVaSFdUTkNkV1JXWkd0VU1XeENXakJXVWxvd1VqRmlNVkY2VTFWME1sSldXbWhqU0ZVeVl6TnZNbE5xYkU1WlZUbFdTekJTTUZORldreE1lVGx0V2xSb1UxSkZWa2ROU0VKdFN6QjRSbFJ0WkV4aWJsWlNWR3RzTlZSc1JrdFdiV2hTVm1wR1RWbFVhRTFSTUhkNVlXdHpOVTlVVW5GYVZsWnpaR3hhV1ZGVU1EbEphWGRwWkcxV2VXTXliSFppYVVrMlNXcEphVXhEU2pCbFdFSnNTV3B2YVZKRlJsVlJWamxNVWxacmFVeERTbXhsU0VKd1kyMUdNR0ZYT1hWSmFtOTRUbXBSTlU1RVl6Rk5SRTAxWmxFOVBRPT0iCgkJfQoJfQp9
type: kubernetes.io/dockerconfigjson
---
{{- end}}

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{.Values.name}}-deployment
spec:
  replicas: {{int .Values.replicas}}
  selector:
    matchLabels:
      app: {{.Values.name}}
  template:
    metadata:
      labels:
        app: {{.Values.name}}
    spec:
      {{- if .Values.dockercfg}}
      imagePullSecrets:
      - name: regcred
      {{- end}}
      containers:
      - name: {{.Values.name}}
        image: {{.Values.image}}
        {{- if or .Values.env.config .Values.env.secrets}}
        envFrom:
        {{- if .Values.env.config}}
        - configMapRef:
            name: {{.Values.name}}
        {{- end}}
        {{- if .Values.env.secrets}}
        - secretRef:
            name: {{.Values.name}}
        {{- end}}
        {{- end}}