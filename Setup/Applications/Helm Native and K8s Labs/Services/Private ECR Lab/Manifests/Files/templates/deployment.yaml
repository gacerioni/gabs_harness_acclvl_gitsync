{{- if .Values.env.config}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{.Values.name}}
data:
{{.Values.env.config | toYaml | indent 2}}
---
{{- end}}

{{- if .Values.env.secrets}}
apiVersion: v1
kind: Secret
metadata:
  name: {{.Values.name}}
stringData:
{{.Values.env.secrets | toYaml | indent 2}}
---
{{- end}}

{{- if .Values.dockercfg}}
apiVersion: v1
kind: Secret
metadata:
  name: {{.Values.name}}-dockercfg
  annotations:
    harness.io/skip-versioning: true
data:
  .dockerconfigjson: ewoJImF1dGhzIjogewoJCSI5MTU2MzI3OTE2OTguZGtyLmVjci5zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSI6IHsKCQkJImF1dGgiOiAiUVZkVE9tVjVTbmRaV0d4ellqSkdhMGxxYjJsUFZHeEZUMFpHYzFGcmNFcGhhbHBhVmtSV1UwOUdXVFJVYlZKV1kwVk9TazlEZERCaGVsWlFVak5PYmxvd05EVmlSV2hLWVcxMFQySlljRTVqVkVWMlZsaGtWR013VmtwU1JUVnVVbTFhU1ZOR1JrVmFNamg0V25wa1FsVldiR3BTTTA1aFN6TkJkazFyZDNaVmJUUTFXa1pTWVZGdFNsaFdSVll3Vlc1d2IwOVZPV2xTV0ZGNlVWaHZlbE50ZURKVk0xcFBUbGhrZDFKWE5YcGxXRXBxV25wTk5GVXphR3RoYXpGeldWUmpNMlJFUW5KV1IyeE1UREphWVZacWFGbFhWRmw2WVd4Q00ySnRTakpsUlhCUFpWaFJNV0pVYURWYVZ6RldUbnBCZUdGNlFuWlVWa3BYVjJ0bmRreDZaRlJhV0U1c1pXNVpNazR3Y3pOaE1rNXBXVlZHVlZVelpEQlpibTh5WWpJMWJsTnRWVFZsVmtGM1lteGFjMUo2VlRGWFZYQXdWMWhPUkZGcmFITlVTR1I2VVRGYVIxUkdXa2RXVlZJeVUxaEdWRXN6Y0dGVVNHZ3dZVWRHVkZKdGRHcE5SWGhLWVdwc1VreDZTbEJSYmxKV1VUQjRlV0pXUmtwYVZFNXNWMWhWTTFReFdtaFNTRnA1VGtkb1dWSkdaRk5rTTNCb1ZteE9XRlZxV2tOWFYxWndWRmhvTlZGNlZtRldWbWN4VFd4R1ZVOVhXWGRPTTNBMFVqTkdjR0ZGYzNwT01tUjBZakZqTUZZeFRucFdSelZ2VkVkT1VsVlZkRlZOVlZKTFkwaEtNMWxYZEhwa01teFlXV3BHVUZadVFrNVpNV2hNWkZack1XSllTVEJqU0dSYVkxZFZlRTlVWkZaVVJFcHZVV3hzVjA1Vk9YRmlXR2h3U3pOR2NGUklhRkpUYTBwS1pFaHNjMk5WTVZwV01XaHVWRWRqY21WSVVtaFRNRFI1V1drNWJGTXhVa2hXUnpneFRtMWtVbFl5ZUVSVmFUbHlZMFJrTkZWdE1ISmliVkpVWlZSR2JHSXhhM2xrVlUxNVRqSkdhRlpIYkhOTmJsSlFUakZDUmxOVk1IWldla28xVWxac2EySldTa05qYld4WlltcFNWVlZYUmxSbFNHTjJZbE4wYjJGWFRsTlpiV2Q0VW14T1ExSnRTbGxTUnpSM1VXazVORlZVYUhOWk1EQTFUVEJOZGxWSFVsQmhSa0pUV2pJNVVrOVliRVJpVm1oSFZHNVdjbFp1WjNkV1ZURlhUMWRrTmxZeFJuWmtSazVOV214b2VtRkhjRWxXV0d4RFYyczVWMHQ1ZERWaVZFcFhUbXQ0ZFZsc1NrSlVWVkpHVkdwQ1Exa3lXbEZrYlU1YVZWUk5kbHB0YkhaamJXUnFUMU4wTUZSdFZuZGlNMWwzVjBaa2RWcFhaRmxaYWtaUFVXcFNXRkV6VlhwTE1GcFZVMFZ3VVZSWFNuVlVWMFpoVkdwb2JsVXhhR3RUYXpseVlrVTRNRnA2YUVKalJHZ3pVV3RPUjFSck5YaGFSVTB3VlRCT2JsTkZjR3BXUm1SRFVsZFdVV051WnpCU1V6aHlVVEJLVTJNelpHaFNNalZOV2xac1NHVklaRnBqUjBaNllURndVV016UW5CaWJYUlJWakExUjFaSFdrWlZSekZKWldwV2NWVnRkSFpYUjJ4U1pVVmFTbUZWYUhaV01IUkxWVzFLUmxNeFNtcGhWV1JzWWxkc2ExSldaRkJoZWxaRlRrWkdWVmRUYzNkU1YzaFJUREJHYUZSVVJYbFNla1pPWVhwT05sTXlhRXBXTURsUldWVXhjV0pVUmxkTmJtUlFXbXhLY1dOcVNrWmpXR3N4VGpOR1VWcFZaRnBhU0dSNVpESlpNazlJUm5OVk1rVXpWR3BDZFZwRmJIaFZNVll4VDBaa00yTnJhR2hWUm5CVlYyeGFlR0ZwZEVoaVJGbzFVMGh3UmxwclZsZE5Sa2t6VVhwa1ExVnNRazFsVjAxMlkydEdibVF3VGsxWmJteEhVMGhHYlZZelNURmlSazB4VFZaR2VHTlVhRkJWU0VwMVVXeE9VbUV5TlhOWFIxWkZVVmRLZDFaVVpGQlNNMlJZVGtoc2Ewc3hUWGRXVkVwRFkwaEtXbFJYZERKaFdIQktWakZDY1UxVGRHeFBSVkYzVmtWU2MySlVVa3RUV0d4b1RsWk9SMk5WZUUxTmJrcFpVMFJKTWxWcmNHdE5lbHBPU3pCM01GVlVTVEJhUjFKeldsUmtjMDVFYUhoYVZrbzBWbnBLTTJNeFVsbGpNakZxVTIxak1tUXpUa3RSVjNCWFkxaHdUVkpGVmpaU01qVk1ZMnRzZWxGc1FYbFZXRXB3VW0xc2VHUnJVbFZYU0ZwTlUwWnNWMU5ZWTNwUmFrMTNZMFpzYjFOdWIzcFZWWFJUVDBkNFRWbFhWbkpYUjFKdlVtNWFkMWRYYnpGT00yZzFWRmRqT1ZCVFNYTkpiVkpvWkVkR2NscFlhMmxQYVVwQ1ZWVnNRMUZWYUhGVlNGSjJaRWRHY0ZKclNsSmtWRTQwVkZoV2MwNUhPVFJVYWtGNlV6TndWMVJVVVRSVVYxcEdVMjB4ZVU1SGVEVk5TSEI2WWxWNE1WVlZhREpOYlRBeFlsYzVjV1ZYWkhoUFZHaFZWbGhCTWxOR1drWk9WR1JDVVZWR1FscHRjRU5QUlVwdVlUTkdiMkV5YkVoUFdHTjNVV3RLTTFsWFpHbGxhMG93VVZka1JsRlZNVWhhTUdSRVZUTkdTRlV3YkdsTk1GSlNVbFZvUWxaRlJteFJiV1J6V2pKb2Nsb3dTbUZWVlRGR1VWWk5NR1F3VmxKVlZURlBZVmhvTmxkdVZuTk5NbVJMVFd0M2QyVnNhM0pSVjJSR1ZWZGtSV1JGYkRKVVdGcHpWRVV4TmxGWFVtcE9hVGgyVlhwamQwd3dPWGxsYkZGMldteHJOVXg2V2paalZVMTZUbFJHZEU1cVFqSk5NR3MxVDFOMFMyTlVZekZqUm1ST1pHcGFTMk5IWkdGTGVrNXlZa2R3VWxWcmFFbGhNV1JSVFZkd1EyTkdjR3hOTTFvelUxZGpPVkJUU1hOSmJscHNZMjVPY0dJeU5HbFBhVWw1U1dsM2FXUkliSGRhVTBrMlNXdFNRbFpGUm1aVE1GWmFTV2wzYVZwWWFIZGhXRXBvWkVkc2RtSnBTVFpOVkZrd1QxUnJlRTU2WnpCT016QTkiCgkJfSwKCQkiaHR0cHM6Ly9pbmRleC5kb2NrZXIuaW8vdjEvIjogewoJCQkiYXV0aCI6ICJaMkZqWlhKcGIyNXBPamt4TkROak4yVTNMVGRqTTJFdE5EUTRPUzFoWkdJMkxUUm1PVEptTkdNeE1UVTFaZz09IgoJCX0KCX0KfQ==
type: kubernetes.io/dockerconfigjson
---
{{- end}}

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{.Values.name}}-deployment
spec:
  replicas: {{int .Values.replicas}}
  selector:
    matchLabels:
      app: {{.Values.name}}
  template:
    metadata:
      labels:
        app: {{.Values.name}}
    spec:
      {{- if .Values.dockercfg}}
      imagePullSecrets:
      - name: {{.Values.name}}-dockercfg
      {{- end}}
      containers:
      - name: {{.Values.name}}
        image: {{.Values.image}}
        {{- if or .Values.env.config .Values.env.secrets}}
        envFrom:
        {{- if .Values.env.config}}
        - configMapRef:
            name: {{.Values.name}}
        {{- end}}
        {{- if .Values.env.secrets}}
        - secretRef:
            name: {{.Values.name}}
        {{- end}}
        {{- end}}