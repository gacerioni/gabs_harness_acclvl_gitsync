harnessApiVersion: '1.0'
type: PIPELINE
description: https://harnesssupport.zendesk.com/agent/tickets/29543
pipelineStages:
- type: ENV_STATE
  name: Non Native Helm Template Workflow
  parallel: false
  skipCondition:
    type: DO_NOT_SKIP
  stageName: STAGE 2
  workflowName: Non Native Helm Template Workflow
  workflowVariables:
  - entityType: ENVIRONMENT
    name: Environment
    value: dev
  - entityType: SERVICE
    name: Service
    value: C6_Helm_Fake
  - entityType: INFRASTRUCTURE_DEFINITION
    name: InfraDefinition_KUBERNETES
    value: mbp_k8s
- type: APPROVAL
  name: Approval 1
  parallel: false
  properties:
    approvalStateParams:
      shellScriptApprovalParams:
        scriptString: |-
          cd /root/harness-service-now/


          #CHANGE_NUMBER=${CHG_NUMBER}
          CHANGE_NUMBER=${workflow.variables.change}
          CMDB_CI_NAME=${service.name}
          #CMDB_CI_NAME=${svc}
          SNOW_USER=svc_harness_CD
          SNOW_PASS=${secrets.getValue("harness_user")}
          URL_SNOW="https://c6bank.service-now.com"

          echo "########"
          echo "${CHANGE_NUMBER}"
          echo "${CMDB_CI_NAME}"
          echo "########"
          echo "${SNOW_USER}"
          echo "${SNOW_PASS}"
          echo "${URL_SNOW}"

          export HARNESS_APPROVAL_STATUS="APPROVED"
        retryInterval: 30000
        delegateSelectors:
        - ec2-final-sa-east-1
    stageName: STAGE 3
    timeoutMillis: 86400000
    approvalStateType: SHELL_SCRIPT
  skipCondition:
    type: DO_NOT_SKIP
  stageName: STAGE 3
